namespace BeansCuest {
    let script: ScriptDefinition = {
        Bean: {
            defaultPosition: mainPosition,
            texts: {
                T0000: {
                    text: "Are you sure this is the best place to start looking for the first stone?",
                    emotion: "questioning",
                },
                T0001: {
                    text: "I can barely make out features, but it looks something like a... frog?",
                    emotion: "curious",
                },
                T0002: {
                    text: "HELLOOOO??",
                    emotion: "happy",
                },
                T0003: {
                    text: "HELLO!? CAN YOU HELP US? WE'RE SEARCHING FOR SOMETHING AND IT'S URGENT!",
                    emotion: "happy",
                },
                T0004: {
                    text: "Shhh...",
                    emotion: "curious",
                },
                T0005: {
                    text: "Hello there. It's okay, we won't hurt you. We just need some information about something lost. Oh, by the way - I'm Bean.",
                    emotion: "smiling",
                },
                T0006: {
                    text: "Nice to meet you, Lillypad! I'm searching for a lost relict, and I think you might be able to help. By any chance - Have you noticed anything strange lately?",
                    emotion: "happy",
                },
                T0007: {
                    text: "That's catastic!",
                    emotion: "happy",
                },
                T0008: {
                    text: "Well, not entirely catastic... I have no idea how to get there. I hate water!",
                    emotion: "resigned",
                },
                T0009: {
                    text: "Nothing is impawssible, Stool. We will keep looking and keep trying until we find a way!",
                    emotion: "determined",
                },
                T0010: {
                    text: "What was it you wanted to say?",
                    emotion: "questioning",
                },
                T0011: {
                    text: "Don't be shy! I'm listening!",
                    emotion: "smiling",
                },
                T0012: {
                    text: "Fur-real?? That's great!",
                    emotion: "surprised",
                },
                T0013: {
                    text: "No, of course not! Why would you think so?",
                    emotion: "curious",
                },
                T0014: {
                    text: "That's mean. I wish I could swim too. I've been afraid of water all my life. It's really distressing. You have a su-paw-power!",
                    emotion: "smiling",
                },
                T0015: {
                    text: "That would be amazing!",
                    emotion: "happy",
                },
                T0016: {
                    text: "Wow, you're amazing, Lillypad! Thank you so much. I really appreciate your help. I'm a little closer to home now!",
                    emotion: "happy",
                },
                T0017: {
                    text: "Thanks for the kind offer - but I wouldn't feel good knowing you're putting yourself at risk for us. I think I'll search for a solution myself.",
                    emotion: "smiling",
                },
                T0018: {
                    text: "I'll look around there. Thanks very much!",
                    emotion: "smiling",
                },
                T0019: {
                    text: "Thank you Lilypad! You helped us a lot!",
                    emotion: "smiling",
                },
                T0020: {
                    text: "I can't see anything, Stool. We need to find a way to get the relic.",
                    emotion: "focused",
                },
                T0021: {
                    text: "She's probably just diving for something. Let her be.",
                    emotion: "focused",
                },
                T0022: {
                    text: "Maybe we can search for something to help us.",
                    emotion: "smiling",
                },
                T0023: {
                    text: "Have you been sitting in the pond for a long time? - If yes, surely you could help us.",
                    emotion: "smiling",
                },
                T0024: {
                    text: "It's about a lost stone that I need to get back home. I came from another world and just ended up here by accident...",
                    emotion: "smiling",
                },
                T0025: {
                    text: "... Because at home I played hide and seek with my best friend Oliver! But now I'm traveling with Sto-",
                    emotion: "focused",
                },
                T0026: {
                    text: "Oh? What happened?",
                    emotion: "confused",
                },
                T0027: {
                    text: "Oh no! My bad.",
                    emotion: "resigned",
                },
                T0028: {
                    text: "Let's search the area for the stones.",
                    emotion: "thinking",
                },
                T0029: {
                    text: "Stool you are great! That could be the stone! We just have to find something to reach it...",
                    emotion: "happy",
                },
                T0030: {
                    text: "Stool. Hear me out. I hold you by your feet.",
                    emotion: "serious",
                },
                T0031: {
                    text: "You dunk your head under the waterlily leaves and search for something to help us reach the stone.",
                    emotion: "serious",
                },
                T0032: {
                    text: "Well, but it was worth a try. Let's look elsewhere.",
                    emotion: "smiling",
                },
                T0033: {
                    text: "Let's check in between these mossy stones.",
                    emotion: "thinking",
                },
                T0034: {
                    text: "HAHAHA Stool! You have to be more careful!",
                    emotion: "laughing",
                },
                T0035: {
                    text: "Did you hurt yourself?",
                    emotion: "smiling",
                },
                T0036: {
                    text: "Hihi - paw promise! Now let's check somewhere else.",
                    emotion: "happy",
                },
                T0037: {
                    text: "Stool, see the reeds? I think I can see something peeking through...",
                    emotion: "focused",
                },
                T0038: {
                    text: "Uhaaah - but - arh - I'm too big -uhh - to fit between the - arhhhg -... Stool? Can you just take a look?",
                    emotion: "thinking",
                },
                T0039: {
                    text: "Pweaaaase?",
                    emotion: "charmed",
                },
                T0040: {
                    text: "Everything's alright?",
                    emotion: "curious",
                },
                T0041: {
                    text: "A Rod! I think this will work! Let's use this rod to try and hook the stone.",
                    emotion: "happy",
                },
                T0042: {
                    text: "Almost... there... got it!",
                    emotion: "focused",
                },
                T0043: {
                    text: "We've already found one! Finding the other two will be a piece of cake.",
                    emotion: "smiling",
                },
                T0044: {
                    text: "We'll find the stones. It wasn't THAT difficult. Let's keep looking. Soo - where are we heading next? What do you suggest?",
                    emotion: "smiling",
                },
                T0045: {
                    text: "Let's go!",
                    emotion: "happy",
                },
            }
        },
        Stool: {
            defaultPosition: secondaryPosition,
            texts: {
                T0000: {
                    text: "Well, I don't know why but something draws me here. Oh Bean - can you see that? Right there, in the pond.",
                    emotion: "anxious"
                },
                T0001: { 
                    text: "SHH - Be careful! You don't know wha-",
                    emotion: "anxious"
                },
                T0002: { 
                    text: "Be careful! You don't know wha-",
                    emotion: "anxious"
                },
                T0003: { 
                    text: "See?? Maybe this wasn't such a good idea after all.",
                    emotion: "disappointed"
                },
                T0004: { 
                    text: "Oh no, what happened to Lillypad?",
                    emotion: "worried"
                },
                T0005: { 
                    text: "...Bean...?",
                    emotion: "worried"
                },
                T0006: { 
                    text: "I think… you might have overwhelmed it...",
                    emotion: "worried"
                },
                T0007: { 
                    text: "Alright - but let's search together. This pond is a bit fishy...",
                    emotion: "anxious"
                },
                T0008: { 
                    text: "By the way - do you see this glowy thing at the bottom of the pond?",
                    emotion: "questioning"
                },
                T0009: { 
                    text: "I don't like where this is going.",
                    emotion: "anxious"
                },
                T0010: { 
                    text: "Absolutely no way.",
                    emotion: "serious"
                },
                T0011: { 
                    text: "*Gurgling* I CRN'T REE A THRING! *Splash*",
                },
                T0012: { 
                    text: "It's pitch black - I literally can't see anything.",
                    emotion: "serious"
                },
                T0013: { 
                    text: "BuT iT wAs WoRtH a TrY.",
                    emotion: "mocking"
                },
                T0014: { 
                    text: "But they are so slippy and slimyYYAHHHHHHHH",
                    emotion: "disgusted"
                },
                T0015: { 
                    text: "I don't think so. But don't ever make me do that again!",
                    emotion: "crying"
                },
                T0016: { 
                    text: "... You know I'm scared, right?",
                    emotion: "anxious"
                },
                T0017: { 
                    text: "Okay I'll do it.",
                    emotion: "crying"
                },
                T0018: { 
                    text: "Yeah, I think I found something.",
                },
                T0019: { 
                    text: "You're doing great, Bean! Keep going!",
                    emotion: "cheering"
                },
                T0020: { 
                    text: "Yes! We did it!",
                    emotion: "happy"
                },
                T0021: { 
                    text: "Okay now we have one stone to repair the portal. But we'll NEVER find the other two! They could be anywhere!",
                    emotion: "hysterical"
                },
                T0022: { 
                    text: "Why are you asking ME??? I don't know! - But...",
                    emotion: "anxious"
                },
                T0023: { 
                    text: "...Something tells me we should search by the Mystique Meadows down the hill. I just can't tell why...",
                    emotion: "explanatory"
                },
            }
        },
        Lillypad: {
            defaultPosition: secondaryPosition,
            texts: {
                T0000: {
                    text: "I-I'm Lillypad.",
                    emotion: "hiding"
                },
                T0001: {
                    text: "I-I don't know much, but I heard a big splash. And I-I think something fell into the pond and now it might be under the lily pads.",
                    emotion: "shy"
                },
                T0002: {
                    text: "A-Actually...",
                    emotion: "shy"
                },
                T0003: {
                    text: "N...Nothing. Nothing important.",
                    emotion: "shy"
                },
                T0004: {
                    text: "I-... I can swim. And dive...",
                    emotion: "blushing"
                },
                T0005: {
                    text: "S-So you're not going to laugh at me?",
                    emotion: "blushing"
                },
                T0006: {
                    text: "Oh... I-I was laughed at by everyone the whole time. That's why I ran away and now I live alone in this pond.",
                    emotion: "sad"
                },
                T0007: {
                    text: "Thank you. I-I may could help you dive down and search for the relict if you'd like.",
                    emotion: "blushing"
                },
                T0008: {
                    text: "Is it this gem you've been looking for?",
                    emotion: "smiling"
                },
                T0009: {
                    text: "It was nothing, really. I- I'm just happy to help. Good luck!",
                    emotion: "blushing"
                },
                T0010: {
                    text: "Too bad. M- Maybe I can help you in some other way.",
                    emotion: "sad"
                },
                T0011: {
                    text: "I saw something in the reeds recently… M- Maybe this can help you.",
                    emotion: "shy"
                },
                T0012: {
                    text: "I-...",
                    emotion: "sad"
                },
            }
        },
    }

    export async function scene3_1(): fS.SceneReturn {
        await fS.Location.show(LOCATIONS.lilypond);
        await makeTransition("inScene");

        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0000],
            [CHARACTERS.Stool, script.Stool.texts.T0000],
            [CHARACTERS.Bean, script.Bean.texts.T0001],
        ], script);

        let dialog: DialogConfig = {
            A: {
                label: "Draw attention",
                callback: optionA
            },
            B: {
                label: "Sneak up",
                callback: optionB
            }
        }

        await createDialog(dialog);
    }

    async function optionA() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0002],
            [CHARACTERS.Stool, script.Stool.texts.T0001],
            [CHARACTERS.Bean, script.Bean.texts.T0003],
        ], script);

        await optionC();
    }

    async function optionB() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0002],
            [CHARACTERS.Bean, script.Bean.texts.T0004],
        ], script);

        await optionC();
    }

    async function optionC() {
        await hideCharacter(CHARACTERS.Stool);
        await makeTransition("fade_in", 0.5);

        await showCharacter(CHARACTERS.Lillypad, "hiding", fS.positionPercent(85, 100));
        await makeTransition("fade_in", 0.5);

        let dialog: DialogConfig = {
            C1: {
                label: "Introduce yourself",
                callback: optionC1
            },
            C2: {
                label: "Don't waste time",
                callback: optionC2
            }
        }

        await createDialog(dialog);
    }

    async function optionC1() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0005],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0000],
            [CHARACTERS.Bean, script.Bean.texts.T0006],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0001],
            [CHARACTERS.Bean, script.Bean.texts.T0007],
            [CHARACTERS.Bean, script.Bean.texts.T0008],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0002],
        ], script);

        await hideCharacter(CHARACTERS.Lillypad);
        await makeTransition("fade_in", 0.5);

        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0003],
            [CHARACTERS.Bean, script.Bean.texts.T0009],
        ], script);

        let dialog: DialogConfig = {
            C1_1: {
                label: "Ask Lillypad",
                callback: optionC1_1
            },
            C1_2: {
                label: "Ignore Lillypad",
                callback: optionC1_2
            }
        }

        await createDialog(dialog);
    }

    async function optionC2() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0023],
            [CHARACTERS.Bean, script.Bean.texts.T0024],
        ], script);

        await hideCharacter(CHARACTERS.Lillypad);
        await makeTransition("fade_in", 0.5);

        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0005],
        ], script);

        await hideCharacter(CHARACTERS.Stool);
        await makeTransition("fade_in", 0.5);
        await showCharacter(CHARACTERS.Lillypad, "scared", fS.positionPercent(85, 100));
        await makeTransition("fade_in", 0.5);

        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0025],
        ], script);

        await hideCharacter(CHARACTERS.Lillypad);
        await makeTransition("fade_in", 0.25);

        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0026],
            [CHARACTERS.Stool, script.Stool.texts.T0006],
            [CHARACTERS.Bean, script.Bean.texts.T0027],
        ], script);

        await optionD();
    }

    async function optionC1_1() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0010],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0003],
            [CHARACTERS.Bean, script.Bean.texts.T0011],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0004],
            [CHARACTERS.Bean, script.Bean.texts.T0012],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0005],
            [CHARACTERS.Bean, script.Bean.texts.T0013],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0006],
            [CHARACTERS.Bean, script.Bean.texts.T0014],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0007],
        ], script);

        let dialog: DialogConfig = {
            C1_1_1: {
                label: "Accept help",
                callback: optionC1_1_1
            },
            C1_1_2: {
                label: "Reject help",
                callback: optionC1_1_2
            }
        }

        await createDialog(dialog);
    }

    async function optionC1_2() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0012],
            [CHARACTERS.Bean, script.Bean.texts.T0019],
            [CHARACTERS.Bean, script.Bean.texts.T0020],
        ], script);

        await hideCharacter(CHARACTERS.Lillypad);
        await makeTransition("fade_in", 0.5)

        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0004],
            [CHARACTERS.Bean, script.Bean.texts.T0021],
            [CHARACTERS.Bean, script.Bean.texts.T0022],
        ], script);

        await optionD();
    }

    async function optionC1_1_1() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0015],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0008],
            [CHARACTERS.Bean, script.Bean.texts.T0016],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0009],
        ], script);

        await optionE();
    }

    async function optionC1_1_2() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0017],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0010],
            [CHARACTERS.Lillypad, script.Lillypad.texts.T0011],
            [CHARACTERS.Bean, script.Bean.texts.T0018],
        ], script);

        await optionD();
    }

    async function optionD() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0028],
        ], script);

        await hideCharacter(CHARACTERS.Lillypad);
        await makeTransition("fade_in", 0.25);

        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0007],
            [CHARACTERS.Stool, script.Stool.texts.T0008],
            [CHARACTERS.Bean, script.Bean.texts.T0029],
        ], script);

        let dialog: DialogConfig = {
            D1: {
                label: "Check waterlilies",
                callback: optionD1
            },
            D2: {
                label: "Check mossy stones",
                callback: optionD2
            },
            D3: {
                label: "Check reeds",
                callback: optionD3
            }
        }

        await createDialog(dialog);
    }

    async function optionD1() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0030],
            [CHARACTERS.Stool, script.Stool.texts.T0009],
            [CHARACTERS.Bean, script.Bean.texts.T0031],
            [CHARACTERS.Stool, script.Stool.texts.T0010],
        ], script);

        await hideCharacter(CHARACTERS.Bean);
        await hideCharacter(CHARACTERS.Stool);
        await fS.Location.show(LOCATIONS.black);
        await makeTransition("fade_in");

        await createSingleLineSpeech(CHARACTERS.Stool, script.Stool.texts.T0011.text);

        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0012],
        ], script);

        await hideCharacter(CHARACTERS.Bean);
        await hideCharacter(CHARACTERS.Stool);
        await fS.Location.show(LOCATIONS.lilypond);
        await makeTransition("inScene");

        const [x, y] = secondaryPosition;

        await showCharacter(CHARACTERS.Stool, "anxious", fS.positionPercent(x, y));

        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0032],
            [CHARACTERS.Stool, script.Stool.texts.T0013],
        ], script);

        await optionD();
    }

    async function optionD2() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0033],
            [CHARACTERS.Stool, script.Stool.texts.T0014],
            [CHARACTERS.Bean, script.Bean.texts.T0034],
            [CHARACTERS.Bean, script.Bean.texts.T0035],
            [CHARACTERS.Stool, script.Stool.texts.T0015],
            [CHARACTERS.Bean, script.Bean.texts.T0036],
        ], script);

        await optionD();
    }

    async function optionD3() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0037],
            [CHARACTERS.Bean, script.Bean.texts.T0038],
            [CHARACTERS.Stool, script.Stool.texts.T0016],
            [CHARACTERS.Bean, script.Bean.texts.T0039],
            [CHARACTERS.Stool, script.Stool.texts.T0017],
        ], script);

        await hideCharacter(CHARACTERS.Stool);
        await makeTransition("fade_in");

        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0040],
        ], script);

        await createSingleLineSpeech(CHARACTERS.Stool, script.Stool.texts.T0018.text);

        await showCharacter(CHARACTERS.Stool, "happy", fS.positionPercent(85, 100));
        await makeTransition("fade_in");

        await letCharactersHaveDialogue([
            [CHARACTERS.Bean, script.Bean.texts.T0041],
            [CHARACTERS.Stool, script.Stool.texts.T0019],
            [CHARACTERS.Bean, script.Bean.texts.T0042],
        ], script);

        await optionE();
    }

    async function optionE() {
        await letCharactersHaveDialogue([
            [CHARACTERS.Stool, script.Stool.texts.T0020],
            [CHARACTERS.Bean, script.Bean.texts.T0043],
            [CHARACTERS.Stool, script.Stool.texts.T0021],
            [CHARACTERS.Bean, script.Bean.texts.T0044],
            [CHARACTERS.Stool, script.Stool.texts.T0022],
            [CHARACTERS.Stool, script.Stool.texts.T0023],
            [CHARACTERS.Bean, script.Bean.texts.T0045], 
        ], script);

        fS.Speech.hide();
        fS.Character.hideAll();
    }

}